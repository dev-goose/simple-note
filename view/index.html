<?php
if(!defined("__GOOSE__")){exit();}

// set nest_id
$nest_id = (isset($_params['nest'])) ? $_params['nest'] : null;

// set index title
if ($_GET['keyword'])
{
	$index_title = 'Search keyword : "'.$_GET['keyword'].'"';
}
else
{
	$index_title = ($data['nest']['name']) ? $data['nest']['name'] : $pref->json['string']['intro_title'];
}
$index_title_url = ($nest_id) ? __ROOT__.'/index/'.$nest_id.'/' : __ROOT__.'/';
?>

<article class="article-index">
	<header>
		<h1><?=$index_title?></h1>
		<nav>
			<ul>
				<li>
					<button type="button" title="toggle search"><i class="lnr lnr-magnifier"></i></button>
					<div>
						<form action="#" method="get" class="keyword-search">
							<fieldset>
								<legend class="blind">Keyword search form</legend>
								<span><input type="text" name="keyword" value="<?=$_GET['keyword']?>" maxlength="20" placeholder="Search Keyword"></span>
								<button type="submit" class="reset"><i class="lnr lnr-chevron-right"></i></button>
							</fieldset>
						</form>
					</div>
				</li>
				<?php
				if ($_GET['keyword'])
				{
					?>
					<li><a href="<?=$index_title_url?>" title="clear search keyword"><i class="lnr lnr-cross"></i></a></li>
					<?php
				}
				?>
			</ul>
		</nav>
	</header>

	<?php
	if (count($data['category']))
	{
		?>
		<div>
			<ul class="category-index">
				<?php
				foreach ($data['category'] as $k=>$v)
				{
					$url = __ROOT__.'/index/'.$nest_id.'/';
					$url .= ($v['srl'] > 0) ? $v['srl'].'/' : '';
					$active = ($v['active']) ? 'class="active"' : '';
					?>
					<li <?=$active?>>
						<a href="<?=$url?>" data-key="<?=$v['srl']?>"><span><?=$v['name']?></span><em><?=$v['count']?></em></a>
					</li>
					<?php
				}
				?>
			</ul>
		</div>
		<?php
	}

	if (count($data['articles']))
	{
		$prefClassNames = $pref->json['index']['classNames'];
		?>
		<!--
			style guide
			"style-card" : card style
			"style-thumnail" : thumnail style
			"color-dark" : dark color
		-->
		<ul class="index <?=$prefClassNames['list']?>">
			<?php
			foreach($data['articles'] as $k=>$v)
			{
				?>
					<li>
						<a href="<?=__ROOT__.'/article/'.$v['srl'].'/'?>">
							<?php
							if ($pref->json['index']['print_thumbnail'])
							{
								if ($v['json']['thumnail']['url'])
								{
									$thumnailUrl = __GOOSE_ROOT__.'/'.$v['json']['thumnail']['url'];
									echo "<figure style=\"background-image: url('".$thumnailUrl."')\"></figure>";
								}
								else
								{
									echo "<figure class=\"not-image\"></figure>";
								}
							}
							?>
							<div>
								<strong><?=$v['title']?></strong>
								<div class="meta">
									<p><span><?=$v['regdate']?></span></p>
									<?=($v['category_name']) ? '<p><span>Cateogry</span><em>'.$v['category_name'].'</em></p>' : ''?>
									<p><span>Hit</span><em><?=$v['hit']?></em></p>
									<?php
									if ($pref->json['article']['updateLike'])
									{
										?>
										<p><span>Like</span><em><?= ($v['json']['like']) ? $v['json']['like'] : 0 ?></em></p>
										<?php
									}
									?>
								</div>
							</div>
						</a>
					</li>
				<?php
			}
			?>
		</ul>
		<?php
	}
	else
	{
		echo '<div class="not-item"><i class="lnr lnr-inbox"></i><span>Not found article</span></div>';
	}

	// paginate
	if ($data['pageNavigation'])
	{
		$nav = $data['pageNavigation'];
		$url_prev = ($nav->prev) ? makeLinkUrl($_target, $_params, [ 'keyword' => $_GET['keyword'], 'page' => $nav->prev['id'] ]) : '';
		$url_next = ($nav->next) ? makeLinkUrl($_target, $_params, [ 'keyword' => $_GET['keyword'], 'page' => $nav->next['id'] ]) : '';
		echo '<nav class="paginate">';
		if ($nav->prev)
		{
			echo "<a href=\"$url_prev\" title=\"".$nav->prev['name']."\" data-key=\"".$nav->prev['id']."\" class=\"dir\"><i class=\"lnr lnr-chevron-left\"></i></a>";
		}
		foreach($nav->body as $k=>$o)
		{
			$url = ($o['active'] == false) ? makeLinkUrl($_target, $_params, [ 'keyword' => $_GET['keyword'], 'page' => (($o['id'] != 1) ? $o['id'] : null) ]) : '';
			echo ($o['active'] == true) ? "<strong>$o[name]</strong>" : "<a href=\"$url\" data-key=\"$o[id]\">$o[name]</a>";
		}
		if ($nav->next)
		{
			echo "<a href=\"$url_next\" title=\"".$nav->next['name']."\" data-key=\"".$nav->next['id']."\" class=\"dir\"><i class=\"lnr lnr-chevron-right\"></i></a>";
		}
		echo '</nav>';
	}
	?>

</article>
